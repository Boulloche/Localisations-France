<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<title>Jeu de Localisation - France</title>
<style>
body { margin:0; font-family:Arial,sans-serif; }
#container { display:flex; height:90vh; }
#map-container {
  flex:3; position:relative; border:1px solid #333;
  background:url("https://www.cartesfrance.fr/cartes/fond_carte_france.jpg") no-repeat center/contain;
  background-size:contain;
}
#game-panel {
  flex:1; margin-left:10px; display:flex; flex-direction:column;
  border:1px solid #333; overflow-y:auto;
  text-align:center;
}
table { width:100%; border-collapse:collapse; flex:1; display:none; }
th, td { border:1px solid #333; padding:5px; text-align:left; }
.zone {
  position:absolute; background:rgba(0,200,100,0.3); cursor:pointer;
  border-radius:50%;
}
.zone.correct { background:green; }
svg { position:absolute; top:0; left:0; width:100%; height:100%; pointer-events:none; }
polygon { fill:rgba(0,200,100,0.3); stroke:blue; stroke-width:2; }
#score-display { font-weight:bold; margin:10px 0; font-size:1.2em; }
#game-question { font-size:1.2em; margin:10px 0; }
#timer { font-weight:bold; margin:10px 0; font-size:1.2em; }
button { padding:5px 10px; margin:5px; cursor:pointer; }
</style>
</head>
<body>
<h2>Jeu de Localisation de France</h2>
<div id="container">
  <div id="map-container"></div>
  <div id="game-panel">
    <div id="score-display">Score: 0/0</div>
    <div id="timer">Temps: 0s</div>
    <div id="game-question">Cliquez sur la carte pour commencer</div>
  </div>
</div>

<script>
// ===== VARIABLES GLOBALES =====
const map = document.getElementById("map-container");
const gameQuestion = document.getElementById("game-question");
const scoreDisplay = document.getElementById("score-display");
const timerDisplay = document.getElementById("timer");

let gameZones = [];
let currentZone = null;
let score = { correct: 0, total: 0 };
let timer = 0;
let timerInterval = null;
let firstClick = false;

// ===== PRÉ-REMPLISSAGE =====
function prefillAdminTable() {
  const locations = [
    {name:"Paris", type:"point"},
    {name:"Marseille", type:"point"},
    {name:"Lyon", type:"point"},
    {name:"Toulouse", type:"point"},
    {name:"Nice", type:"point"},
    {name:"Nantes", type:"point"},
    {name:"Strasbourg", type:"point"},
    {name:"Montpellier", type:"point"},
    {name:"Bordeaux", type:"point"},
    {name:"Lille", type:"point"},
    {name:"Rennes", type:"point"},
    {name:"Reims", type:"point"},
    {name:"Le Havre", type:"point"},
    {name:"Saint-Étienne", type:"point"},
    {name:"Toulon", type:"point"},
    {name:"Grenoble", type:"point"},
    {name:"Dijon", type:"point"},
    {name:"Angers", type:"point"},
    {name:"Nîmes", type:"point"},
    {name:"Villeurbanne", type:"point"},
    {name:"Île-de-France", type:"polygone"},
    {name:"Provence-Alpes-Côte d'Azur", type:"polygone"},
    {name:"Auvergne-Rhône-Alpes", type:"polygone"},
    {name:"Occitanie", type:"polygone"},
    {name:"Nouvelle-Aquitaine", type:"polygone"},
    {name:"Grand Est", type:"polygone"},
    {name:"Hauts-de-France", type:"polygone"},
    {name:"Bretagne", type:"polygone"},
    {name:"Normandie", type:"polygone"},
    {name:"Corsica", type:"polygone"},
    {name:"Seine", type:"point"},
    {name:"Loire", type:"point"},
    {name:"Rhône", type:"point"},
    {name:"Garonne", type:"point"},
    {name:"Alpes", type:"polygone"},
    {name:"Pyrénées", type:"polygone"},
    {name:"Jura", type:"polygone"},
    {name:"Vosges", type:"polygone"},
    {name:"Ouessant", type:"point"}
  ];
  gameZones = locations.map(l => ({...l}));
}

// ===== FONCTIONS DE JEU =====
function shuffle(array) {
  for (let i=array.length-1;i>0;i--){
    const j=Math.floor(Math.random()*(i+1));
    [array[i], array[j]]=[array[j], array[i]];
  }
  return array;
}

function nextQuestion() {
  if (gameZones.length === 0) {
    gameQuestion.textContent = `Jeu terminé ! Score: ${score.correct}/${score.total}`;
    return;
  }
  currentZone = gameZones.pop();
  gameQuestion.textContent = `Placer ${currentZone.name}`;
}

function checkClick(x, y) {
  if (!currentZone) return;
  const tolerance = 20; // pixels
  const zoneX = map.offsetWidth/2; // approximatif pour point générique
  const zoneY = map.offsetHeight/2;

  // Pour simplifier : les zones sont fictives (il faudra ajouter coordonnées exactes si tu veux)
  const isCorrect = Math.abs(x - zoneX) < tolerance && Math.abs(y - zoneY) < tolerance;

  score.total++;
  if (isCorrect) score.correct++;
  scoreDisplay.textContent = `Score: ${score.correct}/${score.total}`;

  nextQuestion();
}

// ===== CHRONOMÈTRE =====
function startTimer() {
  if (firstClick) return;
  firstClick = true;
  timerInterval = setInterval(() => {
    timer++;
    timerDisplay.textContent = `Temps: ${timer}s`;
  }, 1000);
}

// ===== ÉVÉNEMENTS =====
map.addEventListener("click", e => {
  startTimer();
  const rect = map.getBoundingClientRect();
  const x = e.clientX - rect.left;
  const y = e.clientY - rect.top;
  checkClick(x, y);
});

// ===== APPARITION DU JEU =====
window.addEventListener("DOMContentLoaded", () => {
  prefillAdminTable();
  gameZones = shuffle(gameZones);
  nextQuestion();
});
</script>
</body>
</html>
